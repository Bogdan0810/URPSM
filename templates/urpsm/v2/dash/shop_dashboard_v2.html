{% extends "urpsm/v2/dash/base_dashboard_v2.html" %}
{% load static from staticfiles %}{% load i18n%}
{% block title %} {% trans 'Dashboard'|capfirst %} {% endblock %}
{% block heading %} {% trans 'Dashboard'|capfirst %} {% endblock %}
{% block content %}
<section class="content">
          <div class="row">
            <h1 class="onwan"><span class="shortcut-icon"></span>{% trans 'my shop activities'|capfirst %}</h1>
              <div class="col-sm-6 col-md-15">
                  <div class="panel-stat33 bg-color1">
                      <h2 class="m-top-none" id="userCount">{{ clients_count }}</h2>
                      <h5>{% trans 'clients'|capfirst %}</h5>
                      <i class="fa fa-arrow-circle-o-up fa-lg"></i><span class="m-left-xs">{{ new_clients_count }}  {% trans 'new clients'|capfirst %}</span>
                      <div class="stat-icon">
                          <i class="fa fa-user fa-3x"></i>
                      </div>
                  </div>
              </div><!-- /.col -->
              <div class="col-sm-6 col-md-15">
                  <div class="panel-stat33 bg-color2">
                      <h2 class="m-top-none"><span id="serverloadCount">{{ components_count }}</span></h2>
                      <h5>{% trans 'components'|capfirst %}</h5>
                      <i class="fa fa-arrow-circle-o-up fa-lg"></i><span class="m-left-xs">{{ new_components_count }} {% trans 'new components'|capfirst %}</span>
                      <div class="stat-icon">
                          <i class="fa fa-mobile fa-3x"></i>
                      </div>
                  </div>
              </div><!-- /.col -->
              <div class="col-sm-6 col-md-15">
                  <div class="panel-stat33 bg-color3">
                      <h2 class="m-top-none" id="orderCount">{{ revenues }}<sup class="font-19">$</sup></h2>
                      <h5>{% trans 'total revenues'|capfirst %}</h5>
                      {%comment%}
                      <span class=""> {{current_month_revenues}} <sup class="font-13">$</sup> {% trans 'current month revenues'|capfirst %}</span>
                      {%endcomment%}
                      <div class="stat-icon">
                          <i class="fa fa-dollar fa-3x"></i>
                      </div>
                  </div>
              </div><!-- /.col -->
              <div class="col-sm-6 col-md-15">
                  <div class="panel-stat33 bg-color4">
                      <h2 class="m-top-none" id="visitorCount">{{ upcoming_revenues }}<sup class="font-19">$</sup></h2>
                      <h5>{% trans 'upcoming revenues'|capfirst %}</h5>
                      <i class="fa fa-close fa-lg"></i><span class="m-left-xs">&nbsp;{{ not_paid }}&nbsp;{% trans 'not paid yet'|capfirst %}</span>
                      <div class="stat-icon">
                          <i class="fa fa-dollar fa-3x"></i>
                      </div>
                  </div>
              </div><!-- /.col -->
              <div class="col-sm-6 col-md-15">
                  <div class="panel-stat33 bg-color5">
                      <h2 class="m-top-none" id="visitorCount">{{ current_month_revenues }}<sup class="font-19">$</sup></h2>
                      <h5>{% trans 'Current month revenues' %}</h5>
                      <!-- <i class="fa fa-arrow-circle-o-up fa-lg"></i><span class="m-left-xs">lorem text</span> -->
                      <div class="stat-icon">
                          <i class="fa fa-dollar fa-3x"></i>
                      </div>
                  </div>
              </div><!-- /.col -->
          </div>
          <h1 class="onwan"><span class="shortcut-icon"></span>{% trans 'unlocking statistics'|capfirst %}</h1>
          <div class="row">
              <div class="col-sm-6 col-md-15">
                  <div class="panel-stat33 steelblue-light-background">
                      <h2 class="m-top-none" id="visitorCount">{{completed_orders_count}}</h2>
                      <h5>{% trans 'completed'|capfirst %}</h5>
                      <i class="fa fa-arrow-circle-o-up fa-lg"></i><span class="m-left-xs">{{today_completed_orders_count}} {% trans 'completed orders today'|capfirst %}</span>
                      <div class="stat-icon">
                          <i class="fa fa-check fa-3x"></i>
                      </div>
                  </div>
              </div><!-- /.col -->
              <div class="col-sm-6 col-md-15">
                  <div class="panel-stat33 cadetblue-background">
                      <h2 class="m-top-none" id="visitorCount">{{cancelled_orders_count}}</h2>
                      <h5>{% trans 'canceled'|capfirst %}</h5>
                      <i class="fa fa-arrow-circle-o-up fa-lg"></i><span class="m-left-xs">{{today_cancelled_orders_count}} {% trans 'cancelled orders today'|capfirst %}</span>
                      <div class="stat-icon">
                          <i class="fa fa-close fa-3x"></i>
                      </div>
                  </div>
              </div><!-- /.col --> 
              <div class="col-sm-6 col-md-15">
                  <div class="panel-stat33 darkgreen-light-background">
                      <h2 class="m-top-none" id="visitorCount">{{raised_tickets_count}}</h2>
                      <h5>{% trans 'raised tickets'|capfirst %}</h5>
                      <i class="fa fa-arrow-circle-o-up fa-lg"></i><span class="m-left-xs">{{today_raised_tickets_count}} {% trans 'tickets raised today'|capfirst %}</span>
                      <div class="stat-icon">
                          <i class="fa fa-ticket fa-3x"></i>
                      </div>
                  </div>
              </div><!-- /.col -->
            </div>

          <div class="row">      
              <div class="col-md-12">

                <div class="box box-primary">
                  <div class="box-header with-border">
                    <i class="fa fa-bar-chart-o"></i>

                    <h3 class="box-title">{% trans 'last thirty day stats'|title %}</h3>

                    <div class="box-tools pull-right">
                      <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i>
                      </button>
                    </div>
                  </div>
                  <div class="box-body">
                    <div id="line-chart"></div>
                  </div>
                  <div class="spansdata cent-padd10-0">
                    <span class="label red-light-background"> {% trans  'clients'|capfirst %}</span>
                    <span class="label blue-light-background"> {% trans  'components'|capfirst %}</span>
                    <span class="label bg-color3"> {% trans  'total revenues'|capfirst %}</span>
                    <span class="label bg-color4"> {% trans  'upcoming revenues'|capfirst %}</span>
                    <span class="label bg-color5"> {% trans  'current revenues'|capfirst %}</span>
                    <span class="label steelblue-light-background"> {% trans  'compleeted'|capfirst %}</span>
                    <span class="label darkcyan-light-background"> {% trans  'canceled'|capfirst %}</span>
                    <span class="label darkgreen-light-background"> {% trans  'raised tickets'|capfirst %}</span>
                  </div>
                  <!-- /.box-body-->
                </div>
              </div>
              {%comment%}
              <div class="col-md-4">
                <div class="box box-danger">
                    <div class="box-header with-border">
                      <h3 class="box-title">{% trans 'Brands' %}</h3>

                      <div class="box-tools pull-right">
                        <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i>
                        </button>
                      </div>
                    </div>
                      <div class="box-body" style="height: 320px;overflow: auto;">
                        <div class="row">
                          {% for brand in brands%}
                          <div class="col-md-12 padd00">
                            <div class="phoneN" style="background: {{brand.color}};">{{brand.label}}</div>
                            <div class="progress xs" style="height:24px !important;">
                              <div class="progress-bar progress-bar-green" style="width: {{brand.value}}%;background: {{brand.color}};"><span>{{brand.value}}</span></div>
                            </div>
                          </div>
                          {%endfor%}
                          
                        </div>
                      </div>
                 
                  </div>
              </div>
            {%endcomment%}
              <div class="col-md-12">
                  <div class="box box-success">
                    <div class="box-header with-border">
                      <h3 class="box-title">{% trans 'brands'|capfirst %}</h3>
                      <div class="box-tools pull-right">
                        <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i>
                        </button>
                      </div>
                    </div>
                    <div class="box-body">
                      <div id="chart_div"></div>
                    </div>
                    <!-- /.box-body -->
                  </div>
              </div>
              <div class="col-md-12">
                <div class="box box-info">
                        <div class="box-header with-border">
                          <h3 class="box-title">{% trans 'latest clients'|capfirst %}</h3>
                          <div class="box-tools pull-right">
                            <button class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i></button>
                          </div>
                        </div><!-- /.box-header -->
                        <div class="box-body">
                          <div class="table-responsive">
                            <table class="table no-margin">
                              <thead>
                                <tr>
                                  <th>Ref</th>
                                  <th class="width-40">{% trans 'amount'|capfirst %}</th>
                                  <th class="width-40">{% trans 'paid'|capfirst %}</th>
                                  <th>{% trans 'paid for'|capfirst %}</th>
                                </tr>
                              </thead>
                              <tbody>
                              {% for client in clients %}
                                  <tr>
                                    <td><a href="{% url 'clients' %}?q={{ client.ref}}">{{ client.ref}}</a></td>
                                    <td class="text-center"><div class="label label-primary">${{ client.total }}</div></td>
                                    <td class="text-center">{% if client.paid %} <i class="fa fa-circle text-green"></i> {% else %} <i class="fa fa-circle text-red"></i> {% endif %}</td>
                                    <td>{{ client.paid_for }}</td>
                                  </tr>
                                  {%comment%}
                                  <tr>
                                    <td><a href="/clients/16/ticket/">Morocco-646623508</a></td>
                                    <td class="text-center"><div class="label label-primary">$140.00</div></td>
                                    <td class="text-center"> <i class="fa fa-circle red-light-font"></i> </td>
                                    <td>manager</td>
                                  </tr>
                                  {%endcomment%}
                              {%endfor%}
                              </tbody>
                            </table>
                          </div><!-- /.table-responsive -->
                        </div><!-- /.box-body -->
                        <div class="box-footer clearfix">
                          <a href="{% url 'client-create' %}" class="btn btn-sm pull-left darkgreen-light-background">{% trans 'new client'|capfirst %}</a>
                          {% if is_paginated %}
                            <ul class="pagination pagination-sm no-margin pull-right">
                              {% if page_obj.has_previous %}
                            <li>
                              <a href="?{% if query %}q={{ query }}&{% endif %}page={{ page_obj.previous_page_number }}" title="{% trans 'Previous' %}">{% trans 'previous'|capfirst %}</a>
                                </li>
                                {% endif %}
                                <li>
                                    <span class="current">{% trans 'Page' %} {{ page_obj.number }} {% trans 'of' %} {{ page_obj.paginator.num_pages }}</span>
                                </li>
                                {% if page_obj.has_next %}
                                <li>
                                    <a href="?{% if query %}q={{ query }}&{% endif %}page={{ page_obj.next_page_number }}" title="{% trans 'Next' %}">{% trans 'next'|capfirst %}</a>
                                </li>
                                {% endif %}
                            </ul>
                          {% endif %}
                        </div>
                                  

                </div>
            </div>
            {%comment%}
            <div class="col-md-12">
                <div class="box box-info">
                    <div class="box-header with-border">
                      <h3 class="box-title">{% trans 'latest clients'|capfirst %}</h3>
                      <div class="box-tools pull-right">
                        <button class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i></button>
                      </div>
                    </div><!-- /.box-header -->
                    <div class="box-body">
                      <div class="table-responsive">
                        <table class="table no-margin">
                          <thead>
                            <tr>
                              <th>Ref</th>
                              <!-- <th>Imei</th> -->
                              <th class="width-40">{% trans 'amount'|capfirst %}</th>
                              <th class="width-40">{% trans 'paid'|capfirst %}</th>
                              <th>{% trans 'paid to'|capfirst %}</th>
                              <!-- <th>Delivery Date</th> -->
                            </tr>
                          </thead>
                          <tbody>
                            {% for client in clients %}
                                <tr>
                                  <td><a href="{% url 'clients' %}?q={{ client.ref}}">{{ client.ref}}</a></td>
                                  <!-- <td>{#{ client.imei}#}</td> -->
                                  <td class="text-center"><div class="label label-primary">${{ client.total }}</div></td>
                                  <td class="text-center">{% if client.paid %} <i class="fa fa-circle text-green"></i> {% else %} <i class="fa fa-circle text-red"></i> {% endif %}</td>
                                  <td>{{ client.paid_for }}</td>
                                  <!-- <td>{#{ client.delivered_at }#}</td> -->
                                </tr>
                            {% endfor %}
                          </tbody>
                        </table>
                      </div><!-- /.table-responsive -->
                    </div><!-- /.box-body -->
                    <div class="box-footer clearfix">
                      <a href="{% url 'client-create' %}" class="btn btn-sm btn-warning pull-left">{% trans 'new client'|capfirst %}</a>
                      <a href="{% url 'clients' %}" class="btn btn-sm  btn-info pull-right">{% trans 'all clients'|capfirst %}</a>
                    </div><!-- /.box-footer -->
                </div>
            </div>
            {%endcomment%}
        </div>
</section>
{% endblock %}

{% block extrastyle %}
{% endblock %}
{% block extrajs %}
 <!-- FLOT CHARTS -->
  <script src="{% static 'js/plugins/flot/jquery.flot.min.js' %}"></script>
  <!-- FLOT RESIZE PLUGIN - allows the chart to redraw when the window is resized -->
  <script src="{% static 'js/plugins/flot/jquery.flot.resize.min.js' %}"></script>
  <!-- FLOT PIE PLUGIN - also used to draw donut charts -->
  <script src="{% static 'js/plugins/flot/jquery.flot.pie.min.js' %}"></script>
  <!-- FLOT CATEGORIES PLUGIN - Used to draw bar charts -->
  <script src="{% static 'js/plugins/flot/jquery.flot.categories.min.js' %}"></script>
  <script src="{% static 'js/plugins/chartjs/Chart.min.js' %}" type="text/javascript"></script>
      <!-- Morris.js charts -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/raphael/2.1.0/raphael-min.js"></script>
  <script src="{% static 'js/plugins/morris/morris.min.js' %}" type="text/javascript"></script>
  <script type="text/javascript">
  $(function () {
    var line_1 = [],  line_2 = [], line_3 = [], line_4 = [], line_5 = [], line_6 = [], line_7 = [], line_8 = [];
    var total_revenues    = {{thirty_day_total_revenues}};
    var clients           = {{thirty_day_clients}};
    var components        = {{thirty_day_components}};
    var upcoming_revenues = {{thirty_day_upcoming_revenues}};
    var current_revenues  = {{thirty_day_current_month_revenues}};
    var completed         = {{thirty_day_completed_orders}};
    var cancelled         = {{thirty_day_cancelled_orders}};
    var raised_tickets    = {{thirty_day_raised_tickets}};

    $.each(total_revenues, function(index){
      line_1.push([index + 1, clients[index]['amount']]);
      line_2.push([index + 1, total_revenues[index]['amount']]);
      line_3.push([index + 1, components[index]['amount']]);
      line_4.push([index + 1, upcoming_revenues[index]['amount']]);
      line_5.push([index + 1, current_revenues[index]['amount']]);
      line_6.push([index + 1, completed[index]['amount']]);
      line_7.push([index + 1, cancelled[index]['amount']]);
      line_8.push([index + 1, raised_tickets[index]['amount']]);
    });
    var line_data1 = {
      data: line_1,
      color: "#fc8675" 
    };
    var line_data2 = {
      data: line_2,
      color: "#6bafbd"
    };
    var line_data3 = {
      data: line_3,
      color: "#f3ce85"
    };
    var line_data4 = {
      data: line_4,
      color: "#65cea7"
    };
    var line_data5 = {
      data: line_5,
      color: "#7c6dfb"
    };
    var line_data6 = {
      data: line_6,
      color: "#7bbdec"
    };
    var line_data7 = {
      data: line_7,
      color: "#5f9ea0"
    };
    var line_data8 = {
      data: line_8,
      color: "#03969a"
    };
    $.plot("#line-chart", [ line_data1, line_data2, line_data3, line_data4, line_data5, line_data6, line_data7, line_data8], {
      grid: { 
        hoverable: true,
        borderColor: "#f3f3f3",
        borderWidth: 1,
        tickColor: "#f3f3f3"
      },
      series: {
        shadowSize: 0,
        lines: {
          show: true
        },
        points: {
          show: false
        }
      },
      lines: {
        fill: false,
        color: ["#3c8dbc", "#f56954"]
      },
      yaxis: {
        show: true,
      },
      xaxis: {
        show: true
      }
    });
    //Initialize tooltip on hover
    $('<div class="tooltip-inner" id="line-chart-tooltip"></div>').css({
      position: "absolute",
      display: "none",
      opacity: 0.8
    }).appendTo("body");
    $("#line-chart").bind("plothover", function (event, pos, item) {

      if (item) {
        var x = item.datapoint[0].toFixed(2),
            y = item.datapoint[1].toFixed(2);

        $("#line-chart-tooltip").html(item.series.label + " of " + x + " = " + y)
            .css({top: item.pageY + 5, left: item.pageX + 5})
            .fadeIn(200);
      } else {
        $("#line-chart-tooltip").hide();
      }

    });
});
</script>
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript">
      google.charts.load('current', {packages: ['corechart', 'bar']});
      google.charts.setOnLoadCallback(drawBasic);
      function drawBasic() {
        var data = google.visualization.arrayToDataTable([
              ['Mobiles brands', 'Number of clients', { role: 'style' }, { role: 'tooltip' } ],
              {%for bar_data in chart_data %}
              {{bar_data}}{% if not forloop.last %},{% endif %}
              {%endfor%}

              
           ]);
        var options = {
                legend: { position: 'none' },
                chartArea: {
                  left: '2%',
                  top: '2%',
                  bottom: '5%',
                  width: '98%'
                }
              };
           var chart = new google.visualization.ColumnChart(
             document.getElementById('chart_div'));

           chart.draw(data, options);
       }

</script>
{% endblock %}